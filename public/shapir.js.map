import{config}from"../firebase-config.js";function shapir(){firebase.initializeApp(config);var result,obJSON,auth_url,token_url,redirect_url,client_id,client_secret,response_type,scope,grant_type,client_auth,tok,expires_in,properties=[],methods=[],sitesToken=[],currentType="",results=[];return firebase.database().ref("/abstractions").once("value").then(snapshot=>(snapshot.forEach(childSnapshot=>{if("youtube"!=childSnapshot.key){var site=childSnapshot.key;window[site]={};var promise=firebase.database().ref("/abstractions/"+site).once("value").then(function(snapshot){snapshot.forEach(function(childSnapshot){let siteKey=childSnapshot.key,siteVal=childSnapshot.val();if("objects"==siteKey)for(const[key,value]of Object.entries(siteVal)){let type=key,val=eval(value);function self(e,o,t,r,...n){if(currentType=e,"none"==r)var i=o.construct[t].endpoint,c=o.construct[t].input;else{var l=o.construct[t];console.log("arrEndpoints: ",l);var a=l.findIndex(e=>e.property==r);i=o.construct[t][a].endpoint,c=o.construct[t][a].input}var u=n[0],p=o.id,d=o.properties,g=(o.getters,o.setters),h=o.methods,_=[],f="",O="";if(c)for(var S=0;S<c.length;++S)Object.entries(c[S]).forEach(([e,o])=>{f+=`${e}`,f+="=",f+=n[S]}),S+1<c.length&&(f+="&");for(var k=0;k<d.length;++k)null!=d[k].field&&_.push(d[k].property);return firebase.database().ref("/apis/"+i).once("value").then(function(e){return(obJSON=e.val()).oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(e=>new Promise((o,t)=>{console.log("Token: ",e),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:e,grant_type:grant_type},success:function(e){console.log("response: ",e),tok=e.access_token,console.log("tok: ",tok),o("https://scrapir.org/api/"+i+"?tokenAPI="+tok)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+i+"?"+f}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))}))).then(e=>{if(console.log("result: ",e),e.constructor===Array){e.forEach(function(e){for(S in d)if(d[S].field)d[S].property!=d[S].field&&e[d[S].field]&&(Object.defineProperty(e,d[S].property,Object.getOwnPropertyDescriptor(e,d[S].field)),delete e[d[S].field]);else{let o=d[S].property,t=d[S].type;Object.defineProperty(e,o,{get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+t).once("value").then(function(t){return console.log("typeOb4: ",t.val()),self(t.key,t.val(),currentType,o,e[p])})}})}for(s in g){for(var o,t=g[s].field,r=g[s].endpoint,n=(g[s].params,g[s].id),i=0;i<d.length;++i)d[i].field==t&&(o=d[i].property);Object.defineProperty(e,o,{set:function(e){console.log("newValue: ",e),this.pro=firebase.database().ref("/apis/"+r).once("value").then(function(o){return obJSON=o.val(),console.log(obJSON),obJSON.oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(o=>new Promise((i,s)=>{console.log("Token: ",o),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:o,grant_type:grant_type},success:function(o){console.log("response: ",o),tok=o.access_token,console.log("tok: ",tok),i("https://scrapir.org/api/"+r+"?tokenAPI="+tok+"&"+t+"="+e+"&"+n+"="+u)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+r+"?"+f+"&"+pro+"="+e+"&id="+identifier}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e))})))}})}for(var c=0;c<h.length;++c){var l=h[c].name,a=h[c].endpoint,_=h[c].params;Object.defineProperty(e,l.toString(),{value:function(o){if(o.length>0){if(_)for(var t=0;t<_.length;++t)O+=_[t],O+="=",O+=o[t],t+1<_.length&&(O+="&")}else O+=_[0],O+="=",O+=e[_[0]];return console.log("mParamList: ",O),firebase.database().ref("/apis/"+a).once("value").then(function(e){if((obJSON=e.val()).oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+a+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+a+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+a+"?"+O}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}});for(var o=Object.keys(e[0]),t=0;t<o.length;++t)_.includes(o[t])||e.forEach(function(e){delete e[o[t]]})}else{for(S in d)if(d[S].field)d[S].property!=d[S].field&&e[d[S].field]&&(Object.defineProperty(e,d[S].property,Object.getOwnPropertyDescriptor(e,d[S].field)),delete e[d[S].field]);else{let o=d[S].property,t=d[S].type;console.log("typeId: ",p),console.log("o[typeId]1: ",e[p]);var r=e[p];Object.defineProperty(e,o,{get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+t).once("value").then(function(e){return console.log("typeOb1: ",e.val()),console.log("o[typeId]2: ",r),self(e.key,e.val(),currentType,o,r)})}})}for(s in g){for(var n,i=g[s].field,c=g[s].endpoint,l=(g[s].params,g[s].id),a=0;a<d.length;++a)d[a].field==i&&(n=d[a].property);Object.defineProperty(e,n,{set:function(e){console.log("newValue: ",e),this.pro=firebase.database().ref("/apis/"+c).once("value").then(function(o){return obJSON=o.val(),console.log(obJSON),obJSON.oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(o=>new Promise((t,r)=>{console.log("Token: ",o),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:o,grant_type:grant_type},success:function(o){console.log("response: ",o),tok=o.access_token,console.log("tok: ",tok),t("https://scrapir.org/api/"+c+"?tokenAPI="+tok+"&"+i+"="+e+"&"+l+"="+u)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+c+"?"+f+"&"+pro+"="+e+"&id="+identifier}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e))})))}})}for(var k=0;k<h.length;++k){var y=h[k].name,N=h[k].endpoint;Object.defineProperty(e,y.toString(),{value:function(e){var o=Object.entries(e).length;for(const[t,r]of Object.entries(e))--o,console.log(`${t}: ${r}`),O+=t,O+="=",O+=r,o>0&&(O+="&");return console.log("mParamList: ",O),firebase.database().ref("/apis/"+N).once("value").then(function(e){if(obJSON=e.val(),console.log(obJSON),obJSON.oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+N+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+N+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+N+"?"+O}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}for(o=Object.keys(e),t=0;t<o.length;++t)_.includes(o[t])||delete e[o[t]]}return e})}window[site][type]=function(...e){return self(type,val,"self","none",...e)}}if("functions"==siteKey)for(var v=0;v<siteVal.length;++v){let e=siteVal[v].name,o=siteVal[v].endpoint,t=siteVal[v].object,r="",n=siteVal[v].id;var properties=[],fields=[];function siteFunction(e){console.log("siet: ",site);var i=Object.entries(e).length;for(const[o,t]of Object.entries(e))--i,console.log(`${o}: ${t}`),r+=o,r+="=",r+=t,i>0&&(r+="&");for(var c=0;c<properties.length;++c)null!=properties[c].field&&fields.push(properties[c].property);return console.log("mParamList: ",r),firebase.database().ref("/apis/"+o).once("value").then(function(e){if((obJSON=e.val()).oauth2){var t=JSON.parse(localStorage.getItem("tokens"));console.log(t);const e=t.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",t[e].token),""!=t[e].token?new Promise((o,r)=>{o(t[e].token)}).then(n=>new Promise((i,s)=>{console.log("Token: ",n),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:n,grant_type:grant_type},success:function(n){console.log("response: ",n),tok=n.access_token,expires_in=n.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let s=[...t];s[e]={...s[e],token:tok},s[e]={...s[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(s)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),i("https://scrapir.org/api/"+o+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(n=>new Promise((i,s)=>{console.log("Token: ",n),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:n,grant_type:grant_type},success:function(n){console.log("response: ",n),tok=n.access_token,expires_in=n.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let s=[...t];s[e]={...s[e],token:tok},s[e]={...s[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(s)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),i("https://scrapir.org/api/"+o+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+o+"?"+r}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))}))).then(e=>{if(console.log("result: ",e),e.constructor===Array){e.forEach(function(e){for(p in properties)if(properties[p].field)properties[p].property!=properties[p].field&&e[properties[p].field]&&(Object.defineProperty(e,properties[p].property,Object.getOwnPropertyDescriptor(e,properties[p].field)),delete e[properties[p].field]);else{let o=properties[p].property,r=properties[p].type,i=e[n];Object.defineProperty(e,o,{get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+r).once("value").then(function(e){return console.log("typeOb2: ",e.val()),self(e.key,e.val(),t,o,i)})}})}for(var o=0;o<methods.length;++o){var i=methods[o].name,s=methods[o].endpoint,c=methods[o].params;Object.defineProperty(e,i.toString(),{value:function(...o){if(o.length>0){if(c)for(var t=0;t<c.length;++t)r+=c[t],r+="=",r+=o[t],t+1<c.length&&(r+="&")}else r+=c[0],r+="=",r+=e[c[0]];return console.log("mParamList: ",r),firebase.database().ref("/apis/"+s).once("value").then(function(e){if((obJSON=e.val()).oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((n,i)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let i=[...o];i[e]={...i[e],token:tok},i[e]={...i[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(i)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),n("https://scrapir.org/api/"+s+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((n,i)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let i=[...o];i[e]={...i[e],token:tok},i[e]={...i[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(i)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),n("https://scrapir.org/api/"+s+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+s+"?"+r}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}});for(var o=Object.keys(e[0]),i=0;i<o.length;++i)fields.includes(o[i])||e.forEach(function(e){delete e[o[i]]})}else{for(p in properties)if(properties[p].field)properties[p].property!=properties[p].field&&e[properties[p].field]&&(Object.defineProperty(e,properties[p].property,Object.getOwnPropertyDescriptor(e,properties[p].field)),delete e[properties[p].field]);else{let o=properties[p].property,r=properties[p].type,i=ob[n];console.log("typeIdFun2: ",n),console.log("ob[typeId]Fun2: ",ob[n]),this.status={},Object.defineProperty(e,o,{enumerable:!0,get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+r).once("value").then(function(e){return console.log("typeOb3: ",e.val()),self(e.key,e.val(),t,o,i)})}})}for(s in setters){for(var c,l=setters[s].field,a=setters[s].endpoint,u=(setters[s].params,setters[s].id),d=0;d<properties.length;++d)properties[d].field==l&&(c=properties[d].property);Object.defineProperty(e,c,{set:function(e){console.log("newValue: ",e),this.pro=firebase.database().ref("/apis/"+a).once("value").then(function(o){return obJSON=o.val(),console.log(obJSON),obJSON.oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(o=>new Promise((t,r)=>{console.log("Token: ",o),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:o,grant_type:grant_type},success:function(o){console.log("response: ",o),tok=o.access_token,console.log("tok: ",tok),t("https://scrapir.org/api/"+a+"?tokenAPI="+tok+"&"+l+"="+e+"&"+u+"="+idValue)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+a+"?"+paramList+"&"+pro+"="+e+"&id="+identifier}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e))})))}})}for(var g=0;g<methods.length;++g){var h=methods[g].name,_=methods[g].endpoint,f=methods[g].params;Object.defineProperty(e,h.toString(),{value:function(...e){if(f)for(var o=0;o<f.length;++o)r+=f[o],r+="=",r+=e[o],o+1<f.length&&(r+="&");return console.log("mParamList: ",r),firebase.database().ref("/apis/"+_).once("value").then(function(e){if(obJSON=e.val(),console.log(obJSON),obJSON.oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((n,i)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let i=[...o];i[e]={...i[e],token:tok},i[e]={...i[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(i)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),n("https://scrapir.org/api/"+_+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((n,i)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let i=[...o];i[e]={...i[e],token:tok},i[e]={...i[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(i)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),n("https://scrapir.org/api/"+_+"?tokenAPI="+tok+"&"+r)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+_+"?"+r}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}for(o=Object.keys(e),i=0;i<o.length;++i)fields.includes(o[i])||delete e[o[i]]}return e})}function self(e,o,t,r,...n){if(console.log("callerTYPE:",e),console.log("typeId: ",o.id),console.log("args: ",n),currentType=e,"none"==r)var i=o.construct[t].endpoint,c=o.construct[t].input;else{var l=o.construct[t];console.log("arrEndpoints: ",l);var a=l.findIndex(e=>e.property==r);i=o.construct[t][a].endpoint,c=o.construct[t][a].input}var u=n[0],p=o.id,d=o.properties,g=(o.getters,o.setters),h=o.methods,_=[],f="",O="";if(c)for(var S=0;S<c.length;++S)Object.entries(c[S]).forEach(([e,o])=>{f+=`${e}`,f+="=",f+=n[S]}),S+1<c.length&&(f+="&");for(var k=0;k<d.length;++k)null!=d[k].field&&_.push(d[k].property);return firebase.database().ref("/apis/"+i).once("value").then(function(e){return(obJSON=e.val()).oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(e=>new Promise((o,t)=>{console.log("Token: ",e),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:e,grant_type:grant_type},success:function(e){console.log("response: ",e),tok=e.access_token,console.log("tok: ",tok),o("https://scrapir.org/api/"+i+"?tokenAPI="+tok)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+i+"?"+f}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))}))).then(e=>{if(console.log("result: ",e),e.constructor===Array){e.forEach(function(e){for(S in d)if(d[S].field)d[S].property!=d[S].field&&e[d[S].field]&&(Object.defineProperty(e,d[S].property,Object.getOwnPropertyDescriptor(e,d[S].field)),delete e[d[S].field]);else{let o=d[S].property,t=d[S].type;Object.defineProperty(e,o,{get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+t).once("value").then(function(t){return console.log("typeOb4: ",t.val()),self(t.key,t.val(),currentType,o,e[p])})}})}for(s in g){for(var o,t=g[s].field,r=g[s].endpoint,n=(g[s].params,g[s].id),i=0;i<d.length;++i)d[i].field==t&&(o=d[i].property);Object.defineProperty(e,o,{set:function(e){console.log("newValue: ",e),this.pro=firebase.database().ref("/apis/"+r).once("value").then(function(o){return obJSON=o.val(),console.log(obJSON),obJSON.oauth2?new Promise((e,o)=>{auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(o=>new Promise((i,s)=>{console.log("Token: ",o),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:o,grant_type:grant_type},success:function(o){console.log("response: ",o),tok=o.access_token,console.log("tok: ",tok),i("https://scrapir.org/api/"+r+"?tokenAPI="+tok+"&"+t+"="+e+"&"+n+"="+u)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+r+"?"+f+"&"+pro+"="+e+"&id="+identifier}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e))})))}})}for(var c=0;c<h.length;++c){var l=h[c].name,a=h[c].endpoint,_=h[c].params;Object.defineProperty(e,l.toString(),{value:function(...o){if(o.length>0){if(_)for(var t=0;t<_.length;++t)O+=_[t],O+="=",O+=o[t],t+1<_.length&&(O+="&")}else O+=_[0],O+="=",O+=e[_[0]];return console.log("mParamList: ",O),firebase.database().ref("/apis/"+a).once("value").then(function(e){if((obJSON=e.val()).oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+a+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+a+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+a+"?"+O}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}});for(var o=Object.keys(e[0]),t=0;t<o.length;++t)_.includes(o[t])||e.forEach(function(e){delete e[o[t]]})}else{for(S in d)if(d[S].field)d[S].property!=d[S].field&&e[d[S].field]&&(Object.defineProperty(e,d[S].property,Object.getOwnPropertyDescriptor(e,d[S].field)),delete e[d[S].field]);else{let o=d[S].property,t=d[S].type;console.log("typeId: ",p),console.log("o[typeId]1: ",e[p]);var r=e[p];Object.defineProperty(e,o,{get:function(){return firebase.database().ref("/abstractions/"+site+"/objects/"+t).once("value").then(function(e){return console.log("typeOb1: ",e.val()),console.log("o[typeId]2: ",r),self(e.key,e.val(),currentType,o,r)})}})}for(s in g){for(var n,i=g[s].field,c=g[s].endpoint,l=(g[s].params,g[s].id),a=0;a<d.length;++a)d[a].field==i&&(n=d[a].property);Object.defineProperty(e,n,{set:function(e){console.log("newValue: ",e),this.pro=firebase.database().ref("/apis/"+c).once("value").then(function(o){return obJSON=o.val(),console.log(obJSON),obJSON.oauth2?new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(o=>new Promise((t,r)=>{console.log("Token: ",o),console.log("Token URL: ",token_url),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:o,grant_type:grant_type},success:function(o){console.log("response: ",o),tok=o.access_token,console.log("tok: ",tok),t("https://scrapir.org/api/"+c+"?tokenAPI="+tok+"&"+i+"="+e+"&"+l+"="+u)},error:function(e,o,t,r){console.log("error: ",e)}})})):result="https://scrapir.org/api/"+c+"?"+f+"&"+pro+"="+e+"&id="+identifier}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e))})))}})}for(var k=0;k<h.length;++k){var y=h[k].name,N=h[k].endpoint;h[k].params;Object.defineProperty(e,y.toString(),{value:function(e){var o=Object.entries(e).length;for(const[t,r]of Object.entries(e))--o,console.log(`${t}: ${r}`),O+=t,O+="=",O+=r,o>0&&(O+="&");return console.log("mParamList: ",O),firebase.database().ref("/apis/"+N).once("value").then(function(e){if(obJSON=e.val(),console.log(obJSON),obJSON.oauth2){var o=JSON.parse(localStorage.getItem("tokens"));console.log(o);const e=o.findIndex(e=>e.site==site);return console.log("sTokens[elementsIndex]: ",o[e].token),""!=o[e].token?new Promise((t,r)=>{t(o[e].token)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+N+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})})):new Promise((e,o)=>{console.log("auth function"),auth_url=obJSON.oauth2[0].authURL,token_url=obJSON.oauth2[0].tokenURL,redirect_url=obJSON.oauth2[0].callbackURL,client_id=obJSON.oauth2[0].clientId,client_secret=obJSON.oauth2[0].clientSec,response_type=obJSON.oauth2[0].resType,scope=obJSON.oauth2[0].scope,grant_type=obJSON.oauth2[0].grantType,client_auth=obJSON.oauth2[0].clientAuth;var t=window.open(auth_url+"?response_type="+JSON.parse(JSON.stringify(response_type))+"&scope="+JSON.parse(JSON.stringify(scope))+"&client_id="+JSON.parse(JSON.stringify(client_id))+"&redirect_uri="+JSON.parse(JSON.stringify(redirect_url)),"windowname1","width=800, height=600"),r=window.setInterval(function(){try{if(console.log("url here: ",t.document.URL),-1!=t.document.URL.indexOf(redirect_url)){window.clearInterval(r);var o=t.document.URL;acToken=function(e,o){o=o.replace(/[[]/,"[").replace(/[]]/,"]");var t=new RegExp("[?&]"+o+"=([^&#]*)").exec(e);return null==t?"":t[1]}(o,"code"),e(acToken),t.close()}}catch(e){console.log("error in oauth")}},200)}).then(t=>new Promise((r,n)=>{console.log("Token: ",t),$.ajax({url:token_url,method:"POST",data:{client_id:client_id,client_secret:client_secret,redirect_uri:redirect_url,code:t,grant_type:grant_type},success:function(t){console.log("response: ",t),tok=t.access_token,expires_in=t.expires_in,console.log("tok: ",tok),console.log("expires_in: ",expires_in);let n=[...o];n[e]={...n[e],token:tok},n[e]={...n[e],expires_in:expires_in},localStorage.setItem("tokens",JSON.stringify(n)),console.log("NEW LOCAL STORGAE: ",localStorage.getItem("tokens")),r("https://scrapir.org/api/"+N+"?tokenAPI="+tok+"&"+O)},error:function(e,o,t,r){console.log("error: ",e)}})}))}return result="https://scrapir.org/api/"+N+"?"+O}).then(e=>(console.log("url: ",e),new Promise(function(o,t){o(fetch(e).then(e=>e.json()))})))}})}for(o=Object.keys(e),t=0;t<o.length;++t)_.includes(o[t])||delete e[o[t]]}return e})}firebase.database().ref("/abstractions/"+site+"/objects/"+t+"/properties").once("value").then(function(e){e.forEach(function(e){properties.push(e.val())})}),window[site][e]=function(...e){return siteFunction(...e)}}})})}results.push(promise)}),Promise.all(results)))}