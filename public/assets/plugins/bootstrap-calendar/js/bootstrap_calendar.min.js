/* bootstrap_calendar by bic.cat & xero | https://github.com/xero/bootstrap_calendar | released under the Apache License */
$.fn.calendar=function(e){var t=$.extend({},$.fn.calendar.defaults,e);this.each(function(){function p(){n=$('<table class="daysmonth table table">');v();var t=new Date;var s=h.val();if(s!=""){if(w(s)){var o=s.split("/");if(o[2].length==2){if(o[2].charAt(0)=="0"){o[2]=o[2].substring(1)}o[2]=parseInt(o[2]);if(o[2]<50)o[2]+=2e3}t=new Date(o[2],o[1]-1,o[0])}}var u=t.getMonth();var a=t.getFullYear();m(u,a);var f=$('<td><i class="icon-arrow-right"></i></td>');f.click(function(e){e.stopPropagation();e.preventDefault();u=(u+1)%12;if(u==0)a++;d(u,a)});var l=$('<td><i class="icon-arrow-left"></i></td>');l.click(function(e){e.stopPropagation();e.preventDefault();u=u-1;if(u==-1){a--;u=11}d(u,a)});$(".icon-arrow-left").css("cursor","pointer");$(".icon-arrow-right").css("cursor","pointer");var c=$('<table class="table header"><tr></tr></table>');var p=$('<td colspan=5 class="year span6"></td>');c.append(l);c.append(p);c.append(f);p.append(r);e=$('<div class="calendar" id="'+i+'" ></div>');e.prepend(c);e.append(n);h.append(e);E(u,a)}function d(e,t){n.empty();v();m(e,t);E(e,t)}function v(){if(a!=false){var e=$('<tr class="week_days" >');var t="";$(o).each(function(e,n){t+="<td";if(e==0){t+=' class="first"'}if(e==6){t+=' class="last"'}t+=">"+n+"</td>"});t+="</tr>";e.append(t);n.append(e)}}function m(e,t){r.text(u[e]+" "+t);var s=1;var o=g(1,e,t);var a=b(e,t);var f=e+1;var l="";for(var c=0;c<7;c++){if(c<o){var h="";if(c==0)h+="<tr>";h+='<td class="invalid';if(c==0)h+=" first";h+='"></td>'}else{var h="";if(c==0)h+="<tr>";h+='<td id="'+i+"_"+s+"_"+f+"_"+t+'" ';if(c==0)h+=' class="first"';if(c==6)h+=' class="last"';h+="><a>"+s+"</a></span>";if(c==6)h+="</tr>";s++}l+=h}var p=1;while(s<=a){var h="";if(p%7==1)h+="<tr>";h+='<td id="'+i+"_"+s+"_"+f+"_"+t+'" ';if(p%7==1)h+=' class="first"';if(p%7==0)h+=' class="last"';h+="><a>"+s+"</a></td>";if(p%7==0)h+="</tr>";s++;p++;l+=h}p--;if(p%7!=0){h="";for(var c=p%7+1;c<=7;c++){var h="";h+='<td class="invalid';if(c==7)h+=" last";h+='"></td>';if(c==7)h+="</tr>";l+=h}}n.append(l)}function g(e,t,n){var r=new Date(n,t,e);var i=r.getDay();return i}function y(e,t,n){return e>0&&e<13&&n>0&&n<32768&&t>0&&t<=(new Date(n,e,0)).getDate()}function b(e,t){var n=28;while(y(e+1,n+1,t)){n++}return n}function w(e){var t=e.split("/");if(t.length!=3)return false;return y(t[1],t[0],t[2])}function E(e,t){if(c!=false){$.ajax({type:c.type,url:c.url,data:{month:e+1,year:t},dataType:"json"}).done(function(n){s=[];$.each(n,function(e,t){s.push(n[e])});S(e,t)})}else{S(e,t)}}function S(e,t){var n=e+1;for(var r=0;r<s.length;r++){if(s[r][0].split("/")[1]==n&&s[r][0].split("/")[2]==t){$("#"+i+"_"+s[r][0].replace(/\//g,"_")).addClass("event");$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("data-original-title",s[r][1]);if(s[r][3])$("#"+i+"_"+s[r][0].replace(/\//g,"_")).css("background",s[r][3]);if(s[r][2]==""||s[r][2]=="#"){if(s[r][4]!=""){$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("data-trigger","manual");$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").addClass("manual_popover")}else{$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("href","javascript:false;")}}else{$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("href",s[r][2])}if(s[r][4]){$("#"+i+"_"+s[r][0].replace(/\//g,"_")).addClass("event_popover");$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("rel","popover");$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("data-content",s[r][4])}else{$("#"+i+"_"+s[r][0].replace(/\//g,"_")).addClass("event_tooltip");$("#"+i+"_"+s[r][0].replace(/\//g,"_")+" a").attr("rel","tooltip")}}}$("#"+i+" "+".event_tooltip a").tooltip(l);$("#"+i+" "+".event_popover a").popover(f);$(".manual_popover").click(function(){$(this).popover("toggle")})}var e;var n;var r=$('<div class="visualmonthyear"></div>');var i="cal_"+Math.floor(Math.random()*99999).toString(36);var s=t.events;var o;if(typeof t.days!="undefined")o=t.days;else o=["S","M","T","W","T","F","S"];var u;if(typeof t.months!="undefined")u=t.months;else u=["January","February","March","April","May","June","July","August","September","October","November","December"];var a;if(typeof t.show_days!="undefined")a=t.show_days;else a=true;var f;if(t.popover_options!="undefined")f=t.popover_options;else f={placement:"top"};var l;if(typeof t.tooltip_options!="undefined")l=t.tooltip_options;else l={placement:"top"};var c;if(typeof t.req_ajax!="undefined")c=t.req_ajax;else c=false;var h=$(this);p()});return this};